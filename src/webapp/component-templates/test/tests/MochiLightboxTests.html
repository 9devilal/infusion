<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" 
	"http://www.w3.org/TR/html4/strict.dtd">
<!--
 Fluid Project

 Copyright (c) 2006, 2007 University of Toronto. All rights reserved.

 Licensed under the Educational Community License, Version 1.0 (the "License"); 
 you may not use this file except in compliance with the License. 
 You may obtain a copy of the License at 
 
 http://www.opensource.org/licenses/ecl1.php 
 
 Unless required by applicable law or agreed to in writing, software 
 distributed under the License is distributed on an "AS IS" BASIS, 
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 See the License for the specific language governing permissions and 
 limitations under the License.

 Adaptive Technology Resource Centre, University of Toronto
 130 St. George St., Toronto, Ontario, Canada
 Telephone: (416) 978-4360
-->

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Lightbox Tests</title>
	<script language="JavaScript" type="text/javascript" src="../jsunit/app/jsUnitCore.js"> </script>
	<script language="JavaScript" type="text/javascript" src="../../js/MochiKit/MochiKit.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../js/MochiKit/DOM.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../js/MochiKit/Signal.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../js/fluid/MochiLightbox.js"></script>

	<style type="text/css">
		@import "/fluid/css/Lightbox.css";
	</style>

<script>
	
function testHandleArrowKeyPressForLeftAndRight() {
	
	// Create the MochiKit based Lightbox
	//
	var lightbox = new fluid.Lightbox();
	lightbox.buildRendering();
	lightbox.postCreate();
	
	var defaultClass="image-container-default";
	var focusedClass="image-container-selected";
	var draggingClass="image-container-dragging";

	// set the focus on the first image
	assertTrue("fluid.thumb1 should be focused",MochiKit.DOM.hasElementClass (document.getElementById("fluid.thumb1"), focusedClass));
	assertFalse("fluid.thumb1 should not be default", MochiKit.DOM.hasElementClass (document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be not focused",MochiKit.DOM.hasElementClass (document.getElementById("fluid.thumb2"), defaultClass));
	assertFalse("fluid.thumb2 should not be focused", MochiKit.DOM.hasElementClass (document.getElementById("fluid.thumb2"), focusedClass));

	// Test: right arrow to the second image
	var evtRightArrow = {key: function() {var k = {code: 39,  string: 'KEY_ARROW_RIGHT'}; return k;},  preventDefault: function(){}, stop: function(){}, modifier: function() {return false;} };
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("fluid.thumb1 should be default",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertFalse("fluid.thumb1 should not be focused", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), focusedClass));
	assertTrue("fluid.thumb2 should be focused",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), focusedClass));
	assertFalse("fluid.thumb2 should not be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), defaultClass));

	// Test: right arrow to the last image
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("fluid.thumb1 should be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("fluid.thumb3 should be focused", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), focusedClass));

	// Test: left arrow to the previous image
	var evtLeftArrow = {key: function() {var k = {code: 37,  string: 'KEY_ARROW_LEFT'}; return k;},  preventDefault: function(){}, stop: function(){}, modifier: function() {return false;} };
	lightbox.handleArrowKeyPress(evtLeftArrow);
	assertTrue("left arrow to second fluid.thumb1 should be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("left arrow to second fluid.thumb2 should be focused", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), focusedClass));
	assertTrue("left arrow to second fluid.thumb3 should be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), defaultClass));
	
	// Test: right arrow past the last image - expect wrap to the first image
	lightbox.handleArrowKeyPress(evtRightArrow);
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("fluid.thumb1 should be focused after wrapping", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), focusedClass));
	assertFalse("fluid.thumb1 should not be default after wrapping", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertFalse("fluid.thumb2 should not be focused after wrapping", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), focusedClass));
	assertTrue("fluid.thumb3 should be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), defaultClass));
	assertFalse("fluid.thumb3 should not be focused after wrapping", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), focusedClass));
	
	// Test: left arrow on the first image - expect wrap to the last image
	lightbox.handleArrowKeyPress(evtLeftArrow);
	assertTrue("fluid.thumb1 should be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("fluid.thumb3 should be focused", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), focusedClass));	
}

function testHandleKeyUpAndDown() {
	
	// Create the MochiKit based Lightbox
	//
	var lightbox = new fluid.Lightbox();
	lightbox.buildRendering();
	lightbox.postCreate();

	var defaultClass="image-container-default";
	var focusClass="image-container-selected";
	var draggingClass="image-container-dragging";

	// check that none of the images are currently being moved.
	assertFalse("should not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("should not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), draggingClass));
	
	// focus the first thumb
	lightbox.focus(MochiKit.DOM.getElement ("fluid.thumb1"));
	
	// ctrl down - expect dragging state to start
	var evtCTRL = {key: function() {var k = {code: 17,  string: 'KEY_CTRL'}; return k;},  preventDefault: function(){}, stop: function(){}, modifier: function() {return 17;} };
	lightbox.handleKeyDown(evtCTRL);
	assertTrue("should be in move state to start",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("should not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), draggingClass));
	assertFalse("thumb0 should not be focused", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), focusClass));
	
	// right arrow down - all the dragging states should remain the same
	var evtRightArrow = {key: function() {var k = {code: 39,  string: 'KEY_ARROW_RIGHT'}; return k;},  preventDefault: function(){}, stop: function(){}, modifier: function() {return false;} };
	lightbox.handleKeyDown(evtRightArrow);
	assertTrue("should still be in move state to start",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should still not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("should still not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), draggingClass));
	assertFalse("thumb0 should not be focused", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), focusClass));

	// right arrow with key-up event handler. The dragging states should remain the same.
	lightbox.handleKeyUp(evtRightArrow);
	assertTrue("should still be in move state to start",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should still not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("should still not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), draggingClass));
	assertFalse("thumb0 should not be focused", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), focusClass));

    // ctrl up - expect dragging to end
	lightbox.handleKeyUp(evtCTRL);
	assertFalse("should no longer be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should still not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("should still not be in move state",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), draggingClass));
	assertTrue("thumb0 should be focused", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), focusClass));
}

/* NOTE (JS):
    This test file is based on a snapshot of the Lightbox implementation
    (Lightbox.js) and test code (LightboxTests.html) taken on Tue May 29, 2007.
    At that time this "testMove()" automatically failed since its first
    line is/was "assertTrue(false);".  This entire test is commented out so
    it won't be run at all -- no failure is issued.
    
    The MochiKit based light box needs to be updated to be on par with the dojo
    based on.  At that time, this test should be reinstated.

function testMove() {
	assertTrue(false);
		
	// Create the MochiKit based Lightbox
	//
	var lightbox = new fluid.Lightbox();
	lightbox.buildRendering();
	lightbox.postCreate();

	var defaultClass="image-container-default";
	var focusClass="image-container-selected";
	var draggingClass="image-container-dragging";
	
	// ctrl right arrow - expect first and second image to swap
	var evtCTRL = {key: function() {var k = {code: 17,  string: 'KEY_CTRL'}; return k;},  preventDefault: function(){}, stop: function(){}, modifier: function() {return 17;} };
	var evtRightArrow = {key: function() {var k = {code: 39,  string: 'KEY_ARROW_RIGHT'}; return k;},  preventDefault: function(){}, stop: function(){}, modifier: function() {return false;} };
	lightbox.handleKeyDown(evtCTRL);	
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("thumb0 should be in move state", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertTrue("thumb1 should be in default state", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("thumb2 should be in default state", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), defaultClass));

	var lightboxDOMNode = MochiKit.DOM.getElement ("fluid.lightbox");
	var thumbArray = lightboxDOMNode.childNodes;
	assertEquals("fluid.thumb2", thumbArray[0].id);
	assertEquals("fluid.thumb1", thumbArray[1].id);
	assertEquals("fluid.thumb3", thumbArray[2].id);
	
	// Need to clean up the move or the other tests will fail
}

EHD NOTE.
*/

function testFocus () {
	
	// Create the MochiKit based Lightbox
	//
	var lightbox = new fluid.Lightbox();
	lightbox.buildRendering();
	lightbox.postCreate();

	var defaultClass="image-container-default";
	var focusClass="image-container-selected";
	var draggingClass="image-container-dragging";
	
	// the first thumb should be focused
	assertTrue("fluid.thumb1 should be moveable",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), focusClass));
	assertFalse("fluid.thumb2 should not be focused",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), focusClass));
	assertFalse("fluid.thumb3 should not be focused",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), focusClass));
	assertFalse("fluid.thumb1 should not be focused",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be moveable",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("fluid.thumb3 should be moveable",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), defaultClass));
	
	// focus the image
	lightbox.focus(MochiKit.DOM.getElement ("fluid.thumb2"));

	// test the response to the focus
	assertFalse("fluid.thumb2 should not be default", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("fluid.thumb2 should be focused", MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), focusClass));
	
	// focus the image already focused to ensure it remains focused.
	lightbox.focus(MochiKit.DOM.getElement ("fluid.thumb2"));
	assertTrue("fluid.thumb2 should still be focused",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), focusClass));

	// Test: focus a different image and check to see that the previous image is defocused
	// and the new image is focused
	assertTrue("fluid.thumb3 should be default",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), defaultClass));
	assertFalse("fluid.thumb3 should not be focused",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), focusClass));
	
	lightbox.focus(MochiKit.DOM.getElement  ("fluid.thumb3"));
	
	// previous image defocused
	assertTrue("fluid.thumb2 should now be default (previously focused)",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertFalse("fluid.thumb2 should not be focused anymore",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb2"), focusClass));
	
	// new image focused
	assertFalse("fluid.thumb3 should not be default",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), defaultClass));
	assertTrue("fluid.thumb3 should be focused",MochiKit.DOM.hasElementClass(document.getElementById("fluid.thumb3"), focusClass));
	
	// clean up
	MochiKit.DOM.removeElementClass (MochiKit.DOM.getElement ("fluid.thumb3"), focusClass);
	MochiKit.DOM.addElementClass (MochiKit.DOM.getElement ("fluid.thumb3"), defaultClass);
}


</script>
</head>

  <body>
	<p>this is the MochiKit Lightbox test page</p>
	
	<p>Lightbox is: &quot;<script>var anLb = new fluid.Lightbox(); document.write (anLb.toString()); anLb.postCreate();</script>&quot;.</p>

	<div tabIndex="2" id="fluid-lightbox"><div class="float image-container-default" id="fluid.thumb1">
			<a  href="http://localhost:8080/portal/tool/94d4acb8-5be4-495a-00b1-0355205a5dc2/faces/sequence?image=/group/99c5c04c-940a-4e57-8073-2c6ebba2d0a4/Gallery-Tool-Collections/Fruit/Red Apple.gif&amp;auto=off&amp;seq=none" id="gallery:::thumbs-div:::thumbs-link">
				<img  width="100%" src="images/RedApple.jpg" border="0" alt="Red Apple" id="gallery:::thumbs-div:::thumbs-image"/>
				<div  class="caption image-title" id="gallery:::thumbs-div:::thumbs-name">Red Apple</div>
			</a>
		</div><div class="float image-container-default" id="fluid.thumb2">
			<a  href="http://localhost:8080/portal/tool/94d4acb8-5be4-495a-00b1-0355205a5dc2/faces/sequence?image=/group/99c5c04c-940a-4e57-8073-2c6ebba2d0a4/Gallery-Tool-Collections/Fruit/Orange.gif&amp;auto=off&amp;seq=none" id="gallery:::thumbs-div::1:thumbs-link">
    				<img  width="100%" src="images/Orange.jpg" border="0" alt="Orange" id="gallery:::thumbs-div::1:thumbs-image"/>
				<div  class="caption image-title" id="gallery:::thumbs-div::1:thumbs-name">Orange</div>
		  	</a>
		</div><div class="float image-container-default" id="fluid.thumb3">
		  	<a  href="http://localhost:8080/portal/tool/94d4acb8-5be4-495a-00b1-0355205a5dc2/faces/sequence?image=/group/99c5c04c-940a-4e57-8073-2c6ebba2d0a4/Gallery-Tool-Collections/Fruit/Green Apple.gif&amp;auto=off&amp;seq=none" id="gallery:::thumbs-div::2:thumbs-link">
				<img  width="100%" src="images/Banana.jpg" border="0" alt="Banana" id="gallery:::thumbs-div::2:thumbs-image"/>
				<div  class="caption image-title" id="gallery:::thumbs-div::2:thumbs-name">Banana</div>
			</a>
		</div></div>
		
  </body>
</html>
