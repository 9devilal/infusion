<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" 
	"http://www.w3.org/TR/html4/strict.dtd">
<!--
 Fluid Project

 Copyright (c) 2006, 2007 University of Toronto. All rights reserved.

 Licensed under the Educational Community License, Version 1.0 (the "License"); 
 you may not use this file except in compliance with the License. 
 You may obtain a copy of the License at 
 
 http://www.opensource.org/licenses/ecl1.php 
 
 Unless required by applicable law or agreed to in writing, software 
 distributed under the License is distributed on an "AS IS" BASIS, 
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 See the License for the specific language governing permissions and 
 limitations under the License.

 Adaptive Technology Resource Centre, University of Toronto
 130 St. George St., Toronto, Ontario, Canada
 Telephone: (416) 978-4360
-->

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Lightbox Tests</title>
	<script language="JavaScript" type="text/javascript" src="../jsunit/app/jsUnitCore.js"> </script>
		<script type="text/javascript" 
			djConfig="isDebug: true"
			src="/dojo/dojo.js"></script>
		<script type="text/javascript">
			dojo.require("fluid.Lightbox");
			dojo.require("dojo._base.event");
			dojo.require("dijit.util.parser");	// scan page for widgets and instantiate them
		</script>

	<style type="text/css">
		@import "/fluid/templates/Lightbox.css";
	</style>

<script>
	
var imgListClone;

function setUp() {
	imgListClone = document.getElementById("fluid-lightbox").cloneNode(true);
}

function tearDown() {
	var fluidLightboxDOMNode = document.getElementById("fluid-lightbox");
	var lightboxParent = document.getElementById("lightbox-parent");
	lightboxParent.removeChild(fluidLightboxDOMNode);
	lightboxParent.appendChild(imgListClone);
}
	
function testHandleArrowKeyPressForLeftAndRight()	 {
	var lightbox = new fluid.Lightbox();
	var defaultClass="image-container-default";
	var focusedClass="image-container-selected";
	var draggingClass="image-container-dragging";

	// set the focus on the first image
	assertTrue("fluid.thumb1 should be focused",dojo.hasClass(document.getElementById("fluid.thumb1"), focusedClass));
	assertFalse("fluid.thumb1 should not be default", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be not focused",dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertFalse("fluid.thumb2 should not be focused", dojo.hasClass(document.getElementById("fluid.thumb2"), focusedClass));

	// Test: right arrow to the second image
	var evtRightArrow = {keyCode: dojo.keys.RIGHT_ARROW, preventDefault: function(){}, stopPropagation: function(){} };
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("fluid.thumb1 should be default",dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertFalse("fluid.thumb1 should not be focused", dojo.hasClass(document.getElementById("fluid.thumb1"), focusedClass));
	assertTrue("fluid.thumb2 should be focused",dojo.hasClass(document.getElementById("fluid.thumb2"), focusedClass));
	assertFalse("fluid.thumb2 should not be default", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));

	// Test: right arrow to the last image
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("fluid.thumb1 should be default", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be default", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("fluid.thumb3 should be focused", dojo.hasClass(document.getElementById("fluid.thumb3"), focusedClass));

	// Test: left arrow to the previous image
	var evtLeftArrow = {keyCode: dojo.keys.LEFT_ARROW, preventDefault: function(){}, stopPropagation: function(){} };
	lightbox.handleArrowKeyPress(evtLeftArrow);
	assertTrue("left arrow to second fluid.thumb1 should be default", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("left arrow to second fluid.thumb2 should be focused", dojo.hasClass(document.getElementById("fluid.thumb2"), focusedClass));
	assertTrue("left arrow to second fluid.thumb3 should be default", dojo.hasClass(document.getElementById("fluid.thumb3"), defaultClass));
	
	// Test: right arrow past the last image - expect wrap to the first image
	lightbox.handleArrowKeyPress(evtRightArrow);
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("fluid.thumb1 should be focused after wrapping", dojo.hasClass(document.getElementById("fluid.thumb1"), focusedClass));
	assertFalse("fluid.thumb1 should not be default after wrapping", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be default", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertFalse("fluid.thumb2 should not be focused after wrapping", dojo.hasClass(document.getElementById("fluid.thumb2"), focusedClass));
	assertTrue("fluid.thumb3 should be default", dojo.hasClass(document.getElementById("fluid.thumb3"), defaultClass));
	assertFalse("fluid.thumb3 should not be focused after wrapping", dojo.hasClass(document.getElementById("fluid.thumb3"), focusedClass));
	
	// Test: left arrow on the first image - expect wrap to the last image
	lightbox.handleArrowKeyPress(evtLeftArrow);
	assertTrue("fluid.thumb1 should be default", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be default", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("fluid.thumb3 should be focused", dojo.hasClass(document.getElementById("fluid.thumb3"), focusedClass));	
}

function testHandleKeyUpAndDown() {
	var lightbox = new fluid.Lightbox();
	var defaultClass="image-container-default";
	var focusClass="image-container-selected";
	var draggingClass="image-container-dragging";

	// check that none of the images are currently being moved.
	assertFalse("thumb1 should not be in move state to start",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("thumb2 should not be in move state to start",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("thumb3 should not be in move state to start",dojo.hasClass(document.getElementById("fluid.thumb3"), draggingClass));
	
	// focus the first thumb
	lightbox.focus(dojo.byId("fluid.thumb1"));
	
	// ctrl down - expect dragging state to start
	var evtCTRL = {keyCode: dojo.keys.CTRL, preventDefault: function(){}, stopPropagation: function(){} };
	lightbox.handleKeyDown(evtCTRL);
	assertTrue("thumb1 should be in move state after ctrl-down",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("thumb2 should not be in move state after ctrl-down",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("thumb3 should not be in move state after ctrl-down",dojo.hasClass(document.getElementById("fluid.thumb3"), draggingClass));
	assertFalse("thumb1 should not be focused after ctrl-down", dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));
	
	// right arrow down - all the dragging states should remain the same
	var evtRightArrow = {keyCode: dojo.keys.RIGHT_ARROW, preventDefault: function(){}, stopPropagation: function(){} };
	lightbox.handleKeyDown(evtRightArrow);
	assertTrue("thumb1 should still be in move state after right-arrow",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("thumb2 should still not be in move state after right-arrow",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("thumb3 should still not be in move state after right-arrow",dojo.hasClass(document.getElementById("fluid.thumb3"), draggingClass));
	assertFalse("thumb1 should not be focused after right-arrow", dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));

	// right arrow with key-up event handler. The dragging states should remain the same.
	lightbox.handleKeyUp(evtRightArrow);
	assertTrue("thumb1 should still be in move state after right-arrow up",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("thumb2 should still not be in move state after right-arrow up",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("thumb3 should still not be in move state after right-arrow up",dojo.hasClass(document.getElementById("fluid.thumb3"), draggingClass));
	assertFalse("thumb1 should not be focused after right-arrow up", dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));

    // ctrl up - expect dragging to end
	lightbox.handleKeyUp(evtCTRL);
	assertFalse("thumb1 should no longer be in move state after ctrl up",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("thumb2 should still not be in move state after ctrl up",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("thumb3 should still not be in move state after ctrl up",dojo.hasClass(document.getElementById("fluid.thumb3"), draggingClass));
	assertTrue("thumb1 should be focused after ctrl up", dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));
}


function testMove() {
	
//assertTrue("deliberately failing because we don't clean up", false);
	var lightbox = new fluid.Lightbox();
	var defaultClass="image-container-default";
	var focusClass="image-container-selected";
	var draggingClass="image-container-dragging";
	
	var evtCTRL = {keyCode: dojo.keys.CTRL, preventDefault: function(){}, stopPropagation: function(){} };
	var evtRightArrow = {keyCode: dojo.keys.RIGHT_ARROW, ctrlKey: true, preventDefault: function(){}, stopPropagation: function(){} };
	var evtLeftArrow = {keyCode: dojo.keys.LEFT_ARROW, ctrlKey: true, preventDefault: function(){}, stopPropagation: function(){} };
	
	// ctrl right arrow - expect first and second image to swap
	lightbox.handleKeyDown(evtCTRL);	
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("thumb0 should be in move state after ctrl-right", dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertTrue("thumb1 should be in default state after ctrl-right", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("thumb2 should be in default state after ctrl-right", dojo.hasClass(document.getElementById("fluid.thumb3"), defaultClass));

	var lightboxDOMNode = dojo.byId("fluid-lightbox");
	var thumbArray = lightboxDOMNode.childNodes;
	assertEquals("after move right", "fluid.thumb2", thumbArray[0].id);
	assertEquals("after move right", "fluid.thumb1", thumbArray[1].id);
	assertEquals("after move right", "fluid.thumb3", thumbArray[2].id);
	
	// ctrl up
	lightbox.handleKeyUp(evtCTRL);	
	assertTrue("thumb1 should be in selected state", dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));
	assertTrue("thumb2 should be in default state", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("thumb3 should be in default state", dojo.hasClass(document.getElementById("fluid.thumb3"), defaultClass));
	var thumbArray = lightboxDOMNode.childNodes;
	assertEquals("after move right", "fluid.thumb2", thumbArray[0].id);
	assertEquals("after move right", "fluid.thumb1", thumbArray[1].id);
	assertEquals("after move right", "fluid.thumb3", thumbArray[2].id);

	// ctrl left arrow - expect first and second image to swap
	lightbox.handleKeyDown(evtCTRL);	
	lightbox.handleArrowKeyPress(evtLeftArrow);
	assertTrue("thumb1 should be in move state after ctrl-left", dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertTrue("thumb2 should be in default state after ctrl-left", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("thumb3 should be in default state after ctrl-left", dojo.hasClass(document.getElementById("fluid.thumb3"), defaultClass));

	assertEquals("fluid.thumb1", thumbArray[0].id);
	assertEquals("fluid.thumb2", thumbArray[1].id);
	assertEquals("fluid.thumb3", thumbArray[2].id);
	
	// ctrl up
	lightbox.handleKeyUp(evtCTRL);	
	assertTrue("thumb1 should be in selected state", dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));
	assertTrue("thumb2 should be in default state", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("thumb3 should be in default state", dojo.hasClass(document.getElementById("fluid.thumb3"), defaultClass));

	// Need to clean up the move or the other tests will fail
}


function testFocus () {
	var lightbox = new fluid.Lightbox();
	var defaultClass="image-container-default";
	var focusClass="image-container-selected";
	var draggingClass="image-container-dragging";
	
	// the first thumb should be focused
	assertTrue("fluid.thumb1 should be moveable",dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));
	assertFalse("fluid.thumb2 should not be focused",dojo.hasClass(document.getElementById("fluid.thumb2"), focusClass));
	assertFalse("fluid.thumb3 should not be focused",dojo.hasClass(document.getElementById("fluid.thumb3"), focusClass));
	assertFalse("fluid.thumb1 should not be focused",dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be moveable",dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("fluid.thumb3 should be moveable",dojo.hasClass(document.getElementById("fluid.thumb3"), defaultClass));
	
	// focus the image
	lightbox.focus(dojo.byId("fluid.thumb2"));

	// test the response to the focus
	assertFalse("fluid.thumb2 should not be default", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("fluid.thumb2 should be focused", dojo.hasClass(document.getElementById("fluid.thumb2"), focusClass));
	
	// focus the image already focused to ensure it remains focused.
	lightbox.focus(dojo.byId("fluid.thumb2"));
	assertTrue("fluid.thumb2 should still be focused",dojo.hasClass(document.getElementById("fluid.thumb2"), focusClass));

	// Test: focus a different image and check to see that the previous image is defocused
	// and the new image is focused
	assertTrue("fluid.thumb3 should be default",dojo.hasClass(document.getElementById("fluid.thumb3"), defaultClass));
	assertFalse("fluid.thumb3 should not be focused",dojo.hasClass(document.getElementById("fluid.thumb3"), focusClass));
	
	lightbox.focus(dojo.byId ("fluid.thumb3"));
	
	// previous image defocused
	assertTrue("fluid.thumb2 should now be default (previously focused)",dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertFalse("fluid.thumb2 should not be focused anymore",dojo.hasClass(document.getElementById("fluid.thumb2"), focusClass));
	
	// new image focused
	assertFalse("fluid.thumb3 should not be default",dojo.hasClass(document.getElementById("fluid.thumb3"), defaultClass));
	assertTrue("fluid.thumb3 should be focused",dojo.hasClass(document.getElementById("fluid.thumb3"), focusClass));
	
	// clean up
	dojo.removeClass(dojo.byId("fluid.thumb3"),focusClass);
	dojo.addClass(dojo.byId("fluid.thumb3"),defaultClass);
}


</script>
</head>

  <body id="lightbox-parent">
	<p>this is the Lightbox test page</p>


	<input dojoType="fluid.Lightbox" type="hidden"/>
	<div tabIndex="2" id="fluid-lightbox"><div class="float image-container-default" id="fluid.thumb1">
			<a  href="RedApple.gif&amp;auto=off&amp;seq=none" id="gallery:::thumbs-div:::thumbs-link">
				<img  width="100%" src="RedApple.gif" border="0" alt="Red Apple" id="gallery:::thumbs-div:::thumbs-image"/>
				<div  class="caption image-title" id="gallery:::thumbs-div:::thumbs-name">Red Apple</div>
			</a>
		</div><div class="float image-container-default" id="fluid.thumb2">
			<a  href="Orange.gif&amp;auto=off&amp;seq=none" id="gallery:::thumbs-div::1:thumbs-link">
				<img  width="100%" src="Orange.gif" border="0" alt="Orange" id="gallery:::thumbs-div::1:thumbs-image"/>
				<div  class="caption image-title" id="gallery:::thumbs-div::1:thumbs-name">Orange</div>
		  	</a>
		</div><div class="float image-container-default" id="fluid.thumb3">
		  	<a  href="GreenApple.gif&amp;auto=off&amp;seq=none" id="gallery:::thumbs-div::2:thumbs-link">
				<img  width="100%" src="GreenApple.gif" border="0" alt="Green Apple" id="gallery:::thumbs-div::2:thumbs-image"/>
				<div  class="caption image-title" id="gallery:::thumbs-div::2:thumbs-name">Green Apple</div>
			</a>
		</div></div>
		
  </body>
</html>
