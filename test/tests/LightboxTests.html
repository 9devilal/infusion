<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" 
	"http://www.w3.org/TR/html4/strict.dtd">
<!--
 Fluid Project

 Copyright (c) 2006, 2007 University of Toronto. All rights reserved.

 Licensed under the Educational Community License, Version 1.0 (the "License"); 
 you may not use this file except in compliance with the License. 
 You may obtain a copy of the License at 
 
 http://www.opensource.org/licenses/ecl1.php 
 
 Unless required by applicable law or agreed to in writing, software 
 distributed under the License is distributed on an "AS IS" BASIS, 
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 See the License for the specific language governing permissions and 
 limitations under the License.

 Adaptive Technology Resource Centre, University of Toronto
 130 St. George St., Toronto, Ontario, Canada
 Telephone: (416) 978-4360
-->

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Lightbox Tests</title>
	<script language="JavaScript" type="text/javascript" src="../jsunit/app/jsUnitCore.js"> </script>
		<script type="text/javascript" 
			djConfig="isDebug: true"
			src="/dojo/dojo.js"></script>
		<script type="text/javascript">
			dojo.require("fluid.Lightbox");
			dojo.require("dojo._base.event");
			dojo.require("dijit.util.parser");	// scan page for widgets and instantiate them
		</script>

	<style type="text/css">
		@import "/fluid/templates/Lightbox.css";
	</style>

<script>
	
function testHandleArrowKeyPressForLeftAndRight()	 {
	var lightbox;
	var defaultClass="image-container-default";
	var focusedClass="image-container-selected";
	var draggingClass="image-container-dragging";

	lightbox = new fluid.Lightbox();
	var urlList = ["http://foo.com/url1", "http://foo.com/url2", "http://foo.com/url3"];
	var imgList;
	imgList = lightbox.buildImageList(urlList);
	lightbox.setDomNode(imgList);
	document.body.appendChild(lightbox.domNode);

	// set the focus on the first image
	lightbox.focus(dojo.byId("fluid.thumb0"));	
	assertTrue("fluid.thumb0 should be focused",dojo.hasClass(document.getElementById("fluid.thumb0"), focusedClass));
	assertFalse("fluid.thumb0 should not be default", dojo.hasClass(document.getElementById("fluid.thumb0"), defaultClass));
	assertTrue("fluid.thumb1 should be not focused",dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertFalse("fluid.thumb1 should not be focused", dojo.hasClass(document.getElementById("fluid.thumb1"), focusedClass));

	// Test: right arrow to the second image
	var evtRightArrow = {keyCode: dojo.keys.RIGHT_ARROW, preventDefault: function(){}, stopPropagation: function(){} };
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("fluid.thumb0 should be default",dojo.hasClass(document.getElementById("fluid.thumb0"), defaultClass));
	assertFalse("fluid.thumb0 should not be focused", dojo.hasClass(document.getElementById("fluid.thumb0"), focusedClass));
	assertTrue("fluid.thumb1 should be focused",dojo.hasClass(document.getElementById("fluid.thumb1"), focusedClass));
	assertFalse("fluid.thumb1 should not be default", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));

	// Test: right arrow to the last image
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("fluid.thumb0 should be default", dojo.hasClass(document.getElementById("fluid.thumb0"), defaultClass));
	assertTrue("fluid.thumb1 should be default", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be focused", dojo.hasClass(document.getElementById("fluid.thumb2"), focusedClass));

	// Test: left arrow to the previous image
	var evtLeftArrow = {keyCode: dojo.keys.LEFT_ARROW, preventDefault: function(){}, stopPropagation: function(){} };
	lightbox.handleArrowKeyPress(evtLeftArrow);
	assertTrue("left arrow to second fluid.thumb0 should be default", dojo.hasClass(document.getElementById("fluid.thumb0"), defaultClass));
	assertTrue("left arrow to second fluid.thumb1 should be focused", dojo.hasClass(document.getElementById("fluid.thumb1"), focusedClass));
	assertTrue("left arrow to second fluid.thumb2 should be default", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	
	// Test: right arrow past the last image - expect wrap to the first image
	lightbox.handleArrowKeyPress(evtRightArrow);
	lightbox.handleArrowKeyPress(evtRightArrow);
	assertTrue("fluid.thumb0 should be focused after wrapping", dojo.hasClass(document.getElementById("fluid.thumb0"), focusedClass));
	assertFalse("fluid.thumb0 should not be default after wrapping", dojo.hasClass(document.getElementById("fluid.thumb0"), defaultClass));
	assertTrue("fluid.thumb1 should be default", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertFalse("fluid.thumb1 should not be focused after wrapping", dojo.hasClass(document.getElementById("fluid.thumb1"), focusedClass));
	assertTrue("fluid.thumb2 should be default", dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertFalse("fluid.thumb2 should not be focused after wrapping", dojo.hasClass(document.getElementById("fluid.thumb2"), focusedClass));
	
	// Test: left arrow on the first image - expect wrap to the last image
	lightbox.handleArrowKeyPress(evtLeftArrow);
	assertTrue("fluid.thumb0 should be default", dojo.hasClass(document.getElementById("fluid.thumb0"), defaultClass));
	assertTrue("fluid.thumb1 should be default", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be focused", dojo.hasClass(document.getElementById("fluid.thumb2"), focusedClass));	
}

function testHandleKeyUpAndDown() {
	var lightbox;
	var defaultClass="image-container-default";
	var focusClass="image-container-selected";
	var draggingClass="image-container-dragging";

	lightbox = new fluid.Lightbox();
	document.body.appendChild(lightbox.domNode);
	var urlList = ["http://foo.com/url1", "http://foo.com/url2", "http://foo.com/url3"];
	var imgList;
	imgList = lightbox.buildImageList(urlList);
	lightbox.setDomNode(imgList);

	// check that none of the images are currently being moved.
	assertFalse("should not be in move state",dojo.hasClass(document.getElementById("fluid.thumb0"), draggingClass));
	assertFalse("should not be in move state",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should not be in move state",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	
	// focus the first thumb
	lightbox.focus(dojo.byId("fluid.thumb0"));
	
	// ctrl down - expect dragging state to start
	var evtCTRL = {keyCode: dojo.keys.CTRL, preventDefault: function(){}, stopPropagation: function(){} };
	lightbox.handleKeyDown(evtCTRL);
	assertTrue("should be in move state to start",dojo.hasClass(document.getElementById("fluid.thumb0"), draggingClass));
	assertFalse("should not be in move state",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should not be in move state",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("thumb0 should not be focused", dojo.hasClass(document.getElementById("fluid.thumb0"), focusClass));
	
	// right arrow down - all the dragging states should remain the same
	var evtRightArrow = {keyCode: dojo.keys.RIGHT_ARROW, preventDefault: function(){}, stopPropagation: function(){} };
	lightbox.handleKeyDown(evtRightArrow);
	assertTrue("should still be in move state to start",dojo.hasClass(document.getElementById("fluid.thumb0"), draggingClass));
	assertFalse("should still not be in move state",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should still not be in move state",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("thumb0 should not be focused", dojo.hasClass(document.getElementById("fluid.thumb0"), focusClass));

	// right arrow with key-up event handler. The dragging states should remain the same.
	lightbox.handleKeyUp(evtRightArrow);
	assertTrue("should still be in move state to start",dojo.hasClass(document.getElementById("fluid.thumb0"), draggingClass));
	assertFalse("should still not be in move state",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should still not be in move state",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertFalse("thumb0 should not be focused", dojo.hasClass(document.getElementById("fluid.thumb0"), focusClass));

    // ctrl up - expect dragging to end
	lightbox.handleKeyUp(evtCTRL);
	assertFalse("should no longer be in move state",dojo.hasClass(document.getElementById("fluid.thumb0"), draggingClass));
	assertFalse("should still not be in move state",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should still not be in move state",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));
	assertTrue("thumb0 should be focused", dojo.hasClass(document.getElementById("fluid.thumb0"), focusClass));
}



function testMove() {
	
	assertTrue(false);
	
	// ctrl right arrow - expect first and second image to swap
	var evtCTRLRightArrow = {keyCode: dojo.keys.RIGHT_ARROW, ctrlKey: true, preventDefault: function(){}, stopPropagation: function(){} };
	lightbox.handleArrowKeyPress(evtCTRLRightArrow);
	assertTrue("should be in move state",dojo.hasClass(document.getElementById("fluid.thumb0"), draggingClass));
	assertFalse("should not be in move state",dojo.hasClass(document.getElementById("fluid.thumb1"), draggingClass));
	assertFalse("should not be in move state",dojo.hasClass(document.getElementById("fluid.thumb2"), draggingClass));

	var lightboxDOMNode = dojo.byId("fluid.lightbox");
	var thumbArray = lightboxDOMNode.childNodes;
	assertEquals("fluid.thumb1", thumbArray[0].id);
	assertEquals("fluid.thumb0", thumbArray[1].id);
	assertEquals("fluid.thumb2", thumbArray[2].id);
	
}

function testFocus () {
	var lightbox;
	var defaultClass="image-container-default";
	var focusClass="image-container-selected";
	var draggingClass="image-container-dragging";

	lightbox = new fluid.Lightbox();
	var urlList = ["http://foo.com/url1", "http://foo.com/url2", "http://foo.com/url3"];
	var imgList;
	imgList = lightbox.buildImageList(urlList);
	lightbox.setDomNode(imgList);
	document.body.appendChild(lightbox.domNode);
	
	
	// check that nothing is focused
	assertTrue("fluid.thumb0 should be moveable",dojo.hasClass(document.getElementById("fluid.thumb0"), defaultClass));
	assertTrue("fluid.thumb1 should be moveable",dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb2 should be moveable",dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertFalse("fluid.thumb0 should not be focused",dojo.hasClass(document.getElementById("fluid.thumb0"), focusClass));
	assertFalse("fluid.thumb1 should not be focused",dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));
	assertFalse("fluid.thumb2 should not be focused",dojo.hasClass(document.getElementById("fluid.thumb2"), focusClass));
	
	// focus the image
	lightbox.focus(dojo.byId("fluid.thumb1"));

	// test the response to the focus
	assertFalse("fluid.thumb1 should not be default", dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertTrue("fluid.thumb1 should be focused", dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));
	
	// focus the image already focused to ensure it remains focused.
	lightbox.focus(dojo.byId("fluid.thumb1"));
	assertTrue("fluid.thumb1 should still be focused",dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));

	// Test: focus a different image and check to see that the previous image is defocused
	// and the new image is focused
	assertTrue("fluid.thumb2 should be default",dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertFalse("fluid.thumb2 should not be focused",dojo.hasClass(document.getElementById("fluid.thumb2"), focusClass));
	
	lightbox.focus(dojo.byId ("fluid.thumb2"));
	
	// previous image defocused
	assertTrue("fluid.thumb1 should now be default (previously focused)",dojo.hasClass(document.getElementById("fluid.thumb1"), defaultClass));
	assertFalse("fluid.thumb1 should not be focused anymore",dojo.hasClass(document.getElementById("fluid.thumb1"), focusClass));
	
	// new image focused
	assertFalse("fluid.thumb2 should not be default",dojo.hasClass(document.getElementById("fluid.thumb2"), defaultClass));
	assertTrue("fluid.thumb2 should be focused",dojo.hasClass(document.getElementById("fluid.thumb2"), focusClass));
	
	// clean up
	dojo.removeClass(dojo.byId("fluid.thumb2"),focusClass);
	dojo.addClass(dojo.byId("fluid.thumb2"),defaultClass);
}

function testBuildImageList() {
	var lightbox;
	lightbox = new fluid.Lightbox();
	document.body.appendChild(lightbox.domNode);

	assertEquals (0, lightbox.imageList.length);	
	
	var urlList = ["http://foo.com/url1", "http://foo.com/url2", "http://foo.com/url3"];
	var imgList;
	imgList = lightbox.buildImageList(urlList);
	assertEquals (3, imgList.length);

	assertEquals ("http://foo.com/url1", imgList[0].getElementsByTagName("a")[0].href);
	assertEquals ("http://foo.com/url1", imgList[0].getElementsByTagName("img")[0].src);

	assertEquals ("http://foo.com/url2", imgList[1].getElementsByTagName("a")[0].href);
	assertEquals ("http://foo.com/url2", imgList[1].getElementsByTagName("img")[0].src);

	assertEquals ("http://foo.com/url3", imgList[2].getElementsByTagName("a")[0].href);
	assertEquals ("http://foo.com/url3", imgList[2].getElementsByTagName("img")[0].src);
	
	// Test: empty list
	urlList = [];
	imgList = lightbox.buildImageList(urlList);
	assertEquals (0, imgList.length);
	
}

function testSetDomNode() {
	var lightbox;
	lightbox = new fluid.Lightbox();
	var urlList = ["http://foo.com/url1", "http://foo.com/url2", "http://foo.com/url3"];
	var imgList;
	imgList = lightbox.buildImageList(urlList);
	
	assertEquals ("Initial dom node should be length 0",0, lightbox.domNode.getElementsByTagName("*").length);
	
	lightbox.setDomNode(imgList);
	
	assertEquals (6, lightbox.domNode.getElementsByTagName("div").length);

	// Test: empty list
	lightbox = new fluid.Lightbox();
	urlList = [];
	imgList = lightbox.buildImageList(urlList);
	
	lightbox.setDomNode(imgList);
	assertEquals (0, lightbox.domNode.getElementsByTagName("div").length);
}

</script>
</head>

  <body>
	<p>this is the Lightbox test page</p>

	<input id="fluid.thumb0" dojoType="fluid.Lightbox"/>

  </body>
</html>
